# EZ Trading 技术开发指南

本文档详细介绍EZ Trading（AI交易神谕终端）产品的技术架构和开发实现方法，为开发团队提供明确的技术指导。

## 1. 产品概述

EZ Trading是一个面向加密货币散户的轻量级AI交易神谕终端。用户每天登录一次，即可获取一个热点山寨币的操作建议（买入/观望/减仓）。系统由强大的AI多智能体分析引擎支持，通过简洁界面向用户呈现专业级交易建议。其中Oracle Alpha是交易神谕组件的名称。

### 1.1 系统目标

- 为小白用户提供专业级交易建议
- 每日推荐一个热点山寨币及其操作策略
- 通过EAT代币实现策略表现的代币化
- 提供极简用户体验，降低加密交易门槛

### 1.2 核心功能

- **神谕生成**：每日生成一个热点币种的交易建议
- **多智能体分析**：综合技术、基本面和市场情绪分析
- **EAT代币**：基于策略表现的Solana代币
- **用户界面**：极简的交互式终端界面

## 2. 系统架构

EZ Trading采用前后端分离架构，AI分析系统作为核心黑盒处理单元。

### 2.1 整体架构图

```
┌───────────────────┐    ┌───────────────────────────────┐
│                   │    │                               │
│   前端应用层      │◄───┤   API网关层                  │
│   (Vue.js)        │    │   (n8n Webhooks)              │
│                   │    │                               │
└───────────────────┘    └───────────┬───────────────────┘
                                     │
                         ┌───────────▼───────────────────┐
                         │                               │
                         │   工作流处理层               │
                         │   (n8n Workflows)            │
                         │                               │
                         └───────────┬───────────────────┘
                                     │
                  ┌──────────────────┼──────────────────┐
                  │                  │                  │
   ┌──────────────▼─────┐  ┌─────────▼────────┐ ┌──────▼─────────────┐
   │                    │  │                  │ │                     │
   │  市场数据源        │  │  AI分析引擎      │ │  交易执行模块       │
   │  (CoinGlass API)   │  │  (MMXM Agent)    │ │  (3Commas API)      │
   │                    │  │                  │ │                     │
   └────────────────────┘  └──────────────────┘ └─────────────────────┘
                                     │
                          ┌──────────▼───────────┐
                          │                      │
                          │  通知系统           │
                          │  (Slack/Telegram)    │
                          │                      │
                          └──────────────────────┘
```

### 2.2 技术栈概述

| 层级 | 技术选择 | 说明 |
|------|---------|------|
| 前端应用层 | Vue.js, Vite | 轻量级响应式前端框架 |
| API网关层 | n8n Webhooks | 提供HTTP接口供前端调用 |
| 工作流处理层 | n8n Workflows | 自动化工作流编排平台 |
| 市场数据源 | CoinGlass API | 提供加密市场技术数据 |
| AI分析引擎 | MMXM Agent | 多智能体分析系统 |
| 交易执行模块 | 3Commas API | 自动化交易执行平台 |
| 通知系统 | Slack/Telegram API | 实时推送通知 |
| 区块链集成 | Solana | EAT代币发行与管理 |

### 2.3 数据流图

1. 市场数据采集 → AI分析引擎 → 策略生成
2. 策略 → 前端展示 → 用户查看
3. 策略 → 交易执行 → 结果反馈
4. 策略表现 → EAT代币价值计算

## 3. 组件实现方案

EZ Trading包含以下主要组件，每个组件都有其具体的实现方案：

### 3.1 前端神谕终端(Oracle Alpha)

#### 技术选型
- **框架**：Vue 3 + Vite
- **UI库**：轻量级定制UI组件
- **状态管理**：Pinia
- **请求处理**：Axios
- **构建工具**：Vite

#### 主要功能实现
1. **用户认证**
   - 简单的邮箱/密码注册登录
   - 社交媒体账号集成(可选)
   - JWT令牌认证

2. **神谕展示页**
   - 每日推荐币种展示
   - 操作建议可视化
   - 简化的价格图表(TradingView轻量嵌入)

3. **用户配置**
   - 通知偏好设置
   - 风险承受度配置
   - 账户信息管理

4. **历史记录**
   - 过往神谕建议记录
   - 策略表现追踪

#### 开发要点
- 移动端优先的响应式设计
- 精简界面，减少不必要元素
- 优化首屏加载速度(<2s)
- 保持UI一致性和简洁性

### 3.2 n8n工作流系统

#### 核心工作流

1. **行情收集工作流**
   - **触发器**：定时器(每4小时)
   - **数据源**：CoinGlass API
   - **处理节点**：
     - HTTP请求获取K线、资金费率、OI和Heatmap
     - 数据格式化和清洗
     - 发送至MMXM Agent进行分析
   - **存储**：将分析结果存入内存变量

2. **实时价格监听工作流**
   - **触发器**：WebSocket连接
   - **处理节点**：
     - 解析价格数据
     - 比对MMXM判断结果
     - 条件判断(多/空策略满足条件)
   - **执行**：触发交易机器人开关

3. **交易执行工作流**
   - **触发器**：条件满足
   - **处理节点**：
     - 调用3Commas API开启/关闭对应机器人
     - 记录操作历史
   - **通知**：发送操作通知到Slack/Telegram

4. **结果统计工作流**
   - **触发器**：定时器(每日)
   - **处理节点**：
     - 收集交易结果
     - 计算策略表现
     - 更新EAT代币NAV数据

#### 配置要点
- n8n工作流导出为JSON配置文件
- 环境变量分离配置
- 错误处理和重试机制
- 日志记录和监控

### 3.3 AI多智能体分析引擎

#### 系统架构
- **框架**：基于Python的多智能体协作系统
- **模型**：多种专业智能体协作分析

#### 智能体组成
1. **市场分析团队**
   - 新闻分析智能体 - 分析市场新闻和社交媒体情绪
   - 宏观经济智能体 - 分析宏观经济因素
   - 市场情绪智能体 - 评估整体市场情绪

2. **技术分析团队**
   - 价格行为智能体 - 分析价格形态和走势
   - 技术指标智能体 - 分析各类技术指标
   - 形态识别智能体 - 识别经典交易形态

3. **执行团队**
   - 风控智能体 - 评估风险和管理头寸
   - 交易策略智能体 - 生成具体交易策略
   - 资金管理智能体 - 提供资金配置建议

#### 实现步骤
1. 创建各智能体的处理逻辑和模型
2. 设计智能体间的通信协议
3. 实现集成和决策形成机制
4. 添加解释性输出生成

### 3.4 市场数据采集模块

#### 数据源
- **主要数据源**：CoinGlass API
- **补充数据源**：交易所API(如需)

#### 采集数据类型
1. **K线数据**
   - 时间范围：4小时K线
   - 关键字段：开盘价、最高价、最低价、收盘价、成交量

2. **资金费率**
   - 主要交易所的资金费率
   - 历史资金费率趋势

3. **未平仓合约(OI)**
   - 总体OI变化
   - 多空比例

4. **Order-book Heatmap**
   - 买卖盘深度分布
   - 大单密集区域

#### 实现方式
- 使用n8n的HTTP Request节点
- 设置适当的API调用频率
- 实现错误处理和重试机制
- 数据预处理和规范化

### 3.5 交易执行系统

#### 核心功能
- 通过3Commas API控制DCA机器人
- 不直接下单，只控制机器人开关

#### 实现细节
1. **DCA机器人配置**
   - 在3Commas创建Long和Short两种机器人
   - 配置同时活跃仓位为1
   - 设置触发条件、分批加仓、止盈止损等参数

2. **控制逻辑**
   - 开启对应方向的DCA机器人
   - 关闭另一方向的机器人
   - 价格超出区间时关闭机器人

3. **API集成**
   - 使用n8n的HTTP请求节点
   - 调用`/ver1/bots/{bot_id}/enable`和`/ver1/bots/{bot_id}/disable`接口

### 3.6 EAT代币智能合约

#### 技术选型
- **区块链**：Solana
- **合约语言**：Rust
- **标准**：SPL Token

#### 主要功能
1. **代币铸造**
   - 基于策略表现铸造新代币
   - 铸造规则和限制

2. **NAV计算**
   - 根据策略历史表现计算代币NAV
   - 定期更新NAV值

3. **回购销毁**
   - 自动回购机制
   - 代币销毁流程

4. **链上验证**
   - 策略表现的链上记录
   - 公开透明的NAV计算

#### 开发步骤
1. 设计代币经济模型
2. 开发智能合约代码
3. 在测试网部署和测试
4. 安全审计
5. 主网部署

### 3.7 通知推送系统

#### 功能实现
- 使用n8n的Slack/Telegram集成节点
- 设计通知模板和格式

#### 通知内容
- 交易对和方向
- 价格区间信息
- 开关动作说明
- 触发价格
- Heatmap关键信息
- Sonar分析摘要（如有）

## 4. 开发路线图

### 第一阶段：基础架构构建（4周）
1. 前端基础框架搭建
2. n8n工作流环境配置
3. 市场数据采集模块开发
4. AI分析引擎基础架构

### 第二阶段：核心功能实现（6周）
1. AI多智能体系统完善
2. 前端神谕展示界面开发
3. 实时价格监听实现
4. 交易执行系统集成

### 第三阶段：EAT代币开发（4周）
1. 代币智能合约开发
2. NAV计算系统实现
3. 回购机制开发
4. 测试网部署和测试

### 第四阶段：系统优化与上线（4周）
1. 性能优化和压力测试
2. 安全审计和漏洞修复
3. 用户体验改进
4. 正式环境部署

## 5. 开发环境配置

### 前端开发环境
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build
```

### n8n工作流环境
```bash
# 安装n8n
npm install n8n -g

# 启动n8n服务
n8n start

# 导入工作流
# 访问 http://localhost:5678 并导入工作流JSON文件
```

### AI开发环境
```bash
# 安装依赖
pip install -r requirements.txt

# 启动MMXM Agent服务
python -m backend.ai.agent
```

### Solana开发环境
```bash
# 安装Solana工具链
sh -c "$(curl -sSfL https://release.solana.com/stable/install)"

# 启动本地测试网
solana-test-validator

# 编译部署合约
cd contracts
yarn install
yarn build
yarn deploy
```

## 6. 测试策略

### 单元测试
- 前端组件测试：Vue Test Utils + Jest
- 后端逻辑测试：Pytest
- 智能合约测试：Solana程序测试框架

### 集成测试
- API集成测试
- 工作流测试
- 前后端集成测试

### 系统测试
- 端到端功能测试
- 性能和负载测试
- 安全测试

### 策略回测
- 历史数据回测系统
- 策略有效性验证
- 绩效评估指标

## 7. 部署方案

### 开发环境
- 本地开发环境
- 开发服务器（团队共享）

### 测试环境
- 功能测试环境
- 性能测试环境
- 用户体验测试环境

### 生产环境
- 应用服务器
- 数据库服务器
- 监控和日志系统
- 备份和恢复方案

## 8. 文档与资源

- [系统需求规格](./REQUIREMENTS.md)
- [前台系统规格](./FRONTEND_SPEC.md)
- [技术实现方案](./IMPLEMENTATION.md)
- [EAT代币白皮书](./EAT_WHITEPAPER.md)
- [项目计划](./PROJECT_PLAN.md)
- [API文档](../docs/api)
- [设计资源](../assets/design) 